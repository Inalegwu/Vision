name : New App Version

on:
    workflow_dispatch:
        inputs:
            release-type:
                type: choice
                description: 'Release type (one of): patch , minor ,major'
                required: true
                default: 'patch'
                options:
                    - patch
                    - minor
                    - major

jobs:
    release:
        name: Create New Version and Push New Tag
        runs-on: ubuntu-latest
        permissions:
            contents: write
        
        steps:
            - name: ğŸ” GH_TOKEN
              if: env.GH_TOKEN==''
              env:
                GITHUB_TOKEN: ${{secrets.GITHUB_TOKEN}}
              run: echo "GH_TOKEN=${GITHUB_TOKEN}">>$GITHUB_ENV
            
            - name: ğŸ“¦ Checkout Project Repo
              uses: actions/checkout@v3
              with:
                fetch-depth: 0
                token: ${{secrets.GH_TOKEN}}
            
            - name : ğŸ“ Git User Setup
              run: |
                git config --global user.email "41898282+github-actions[bot]@users.noreply.github.com"
                git config --global user.name "disgruntled-actions[bot]"

            - name: ğŸ“¦ PNPM + install deps
              uses: ./.github/actions/setup-node-pnpm


            - name: ğŸƒâ€â™‚ï¸ Run App release
              run: |
                pnpm app-release ${{ github.event.inputs.release-type }}